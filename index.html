<!DOCTYPE html>
<html lang="zh-CH">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Megrax's Blog</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/footer.css">
</head>

<body>
    <!-- å¤´éƒ¨æ¨¡å— -->
    <header>
        <h1>
            <a href="#">Megrax's Blog</a>
        </h1>
    </header>

    <!-- ä¸­éƒ¨å¯¼èˆªæ æ¨¡å— -->
    <nav class="w">
        <ul>
            <li><a href="#">é¦–é¡µ</a></li>
            <li><a href="#">Lists</a></li>
            <li><a href="#">Tags</a></li>
            <li><a href="#">Links</a></li>
            <li><a href="#">About Me</a></li>
        </ul>
    </nav>

    <!-- ä¸»ä½“æ¨¡å— -->
    <section class="w clearfix">
        <!-- è¾¹æ æ¨¡å— -->
        <aside>
            <ul>
                <li><a href="#">Tech</a></li>
                <li><a href="#">Life</a></li>
                <li><a href="#">Literature</a></li>
                <li>è®¿é—®ä¿¡æ¯ç»Ÿè®¡</li>
            </ul>
        </aside>
        <!-- æ–‡ç« éƒ¨åˆ† -->
        <article>
            > Haloæ˜¯ä¸€ä¸ªåŸºäºSpring
            Bootçš„å¼€æºåšå®¢æ¡†æ¶ï¼Œå¹¶ä¸”æ˜“äºä¸Šæ‰‹ã€‚è¿™ç¯‡åšå®¢åŸºæœ¬æ˜¯å®˜ç½‘å®‰è£…æŒ‡å—çš„æ¬è¿ï¼Œæˆ‘æŠŠã€Œå®‰è£…ã€å’Œã€Œéƒ¨ç½²ã€çš„ä¸¤ç¯‡æ–‡ç« åˆåœ¨ä¸€èµ·ï¼Œç„¶åä½œäº†ä¸å¤§çš„æ”¹åŠ¨ï¼Œä¸»è¦è¿˜æ˜¯ç†Ÿæ‚‰ä¸€ä¸‹Markdownæ–‡æ¡£çš„å†™ä½œğŸ¤£ã€‚è¦æ˜¯å¯¹Haloåšå®¢æ­å»ºéƒ¨ç½²æœ‰ç–‘é—®çš„è¯å¯ä»¥åœ¨æ–‡æœ«ç•™è¨€å–”ã€‚
            >
            >åŸæ–‡ä¼ é€:[Haloå®‰è£…æŒ‡å—](https://halo.run/archives/install-with-linux.html)

            ***
            ### è¦æ±‚
            1. ç†Ÿæ‚‰ç®€å•çš„Linuxæ“ä½œ
            2. ä¸€å°LinuxæœåŠ¡å™¨ï¼Œè¿™é‡Œç”¨Centos 7.xçš„æ“ä½œç³»ç»Ÿåšæ¼”ç¤º
            3. æ‹¥æœ‰ä¸€ä¸ªåŸŸåï¼Œå¹¶å°†æœåŠ¡å™¨çš„IPæˆåŠŸè§£æåˆ°åŸŸå
            4. å¼€æ”¾Haloçš„è¿è¡Œç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º8090
            ***
            ### æ¨èé…ç½®
            - æ“ä½œç³»ç»Ÿï¼šCentos 7.x
            - å†…å­˜ï¼š512MBä»¥ä¸Š
            ***
            ### é…ç½®æœåŠ¡å™¨
            #### æ›´æ–°è½¯ä»¶åŒ…
            è¯·ç¡®ä¿æœåŠ¡å™¨çš„è½¯ä»¶åŒ…æ˜¯æœ€æ–°çš„ã€‚
            `sudo yum update -y`
            #### å®‰è£…Javaè¿è¡Œç¯å¢ƒ
            > å·²å­˜åœ¨Javaè¿è¡Œç¯å¢ƒå¯ç•¥è¿‡è¿™ä¸€æ­¥ã€‚
            ```
            # å®‰è£… OpenJRE
            sudo yum install java-1.8.0-openjdk -y

            # æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ
            java -version
            ```
            ***
            ### åˆ›å»ºHaloç”¨æˆ·

            æ¨èåˆ›å»ºä¸€ä¸ªä½æƒé™çš„ç”¨æˆ·è¿è¡Œ`halo`ï¼š

            ```
            # åˆ›å»º halo ç”¨æˆ·
            sudo useradd -m halo
            # ç›´æ¥ç™»å½•è¯¥ç”¨æˆ·
            sudo su halo
            ```
            ***
            ### å®‰è£…Halo

            #### ä¸‹è½½é…ç½®æ–‡ä»¶

            å¯ä½¿ç”¨Haloå®˜ç½‘æä¾›çš„é…ç½®æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶è·¯å¾„ä¸º`~/.halo/application.yaml`ã€‚

            ```
            # ä¸‹è½½é…ç½®æ–‡ä»¶åˆ° ~/.halo ç›®å½•
            curl -o ~/.halo/application.yaml --create-dirs https://dl.halo.run/config/application-template.yaml
            ```
            #### ä¿®æ”¹é…ç½®æ–‡ä»¶

            å¯ä»¥è‡ªå·±é…ç½®`Halo`çš„è¿è¡Œç«¯å£ï¼Œä»¥åŠæ•°æ®åº“ç›¸å…³é…ç½®ã€‚

            ```
            # ä½¿ç”¨ Vim æ‰“å¼€ä¸ä¿®æ”¹é…ç½®æ–‡ä»¶
            vim ~/.halo/application.yaml
            ```

            æ–‡ä»¶å¦‚ä¸‹

            ```
            server:
            port: 8090

            # Response data gzip.
            compression:
            enabled: false
            spring:
            datasource:
            # H2 database configuration.
            driver-class-name: org.h2.Driver
            url: jdbc:h2:file:~/.halo/db/halo
            username: admin
            password: 123456

            # MySQL database configuration.
            # driver-class-name: com.mysql.cj.jdbc.Driver
            # url:
            jdbc:mysql://127.0.0.1:3306/halodb?characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
            # username: root
            # password: 123456

            # H2 database console configuration.
            h2:
            console:
            settings:
            web-allow-others: false
            path: /h2-console
            enabled: false

            halo:
            # Your admin client path is https://your-domain/{admin-path}
            admin-path: admin

            # memory or level
            cache: memory
            ```

            1. å¦‚éœ€è‡ªå®šä¹‰ç«¯å£ï¼Œå¯ç›´æ¥ä¿®æ”¹`server`ä¸‹çš„`port`å¯¹åº”çš„æ•°å­—ã€‚
            2. é»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“æ˜¯`H2 Database`ï¼Œè¿™æ˜¯ä¸€ç§åµŒå…¥å¼çš„æ•°æ®åº“ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ä¸º`admin`å’Œ`123456`ï¼Œè¯·ä¿®æ”¹å¹¶ä¿å­˜ã€‚
            3. å¦‚æœéœ€è¦ä½¿ç”¨ `MySQL` æ•°æ®åº“ï¼Œéœ€è¦å°† `H2 Database` çš„æ‰€æœ‰ç›¸å…³é…ç½®éƒ½æ³¨é‡Šæ‰ï¼Œå¹¶å–æ¶ˆ `MySQL` çš„ç›¸å…³é…ç½®ã€‚å¦å¤–ï¼Œ`MySQL` çš„é»˜è®¤æ•°æ®åº“åä¸º `halodb`ï¼Œè¯·è‡ªè¡Œé…ç½®
            `MySQL` å¹¶åˆ›å»ºæ•°æ®åº“ï¼Œä»¥åŠä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ã€‚
            4. `h2` èŠ‚ç‚¹ä¸º `H2 Database` çš„æ§åˆ¶å°é…ç½®ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¦‚éœ€ä½¿ç”¨è¯·å°† `h2.console.settings.web-allow-others` å’Œ `h2.console.enabled`
            è®¾ç½®ä¸º `true`ã€‚æ§åˆ¶å°åœ°å€å³ä¸º `åŸŸå/h2-console`ã€‚æ³¨æ„ï¼šéç´§æ€¥æƒ…å†µï¼Œä¸å»ºè®®å¼€å¯è¯¥é…ç½®ã€‚
            5. `server.compression.enabled` ä¸º `Gzip` åŠŸèƒ½é…ç½®ï¼Œå¦‚æœ‰éœ€è¦è¯·è®¾ç½®ä¸º `true`ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨ `Nginx` æˆ–è€… `Caddy`
            è¿›è¡Œåå‘ä»£ç†çš„è¯ï¼Œé»˜è®¤æ˜¯æœ‰å¼€å¯ `Gzip` çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä¿æŒé»˜è®¤ã€‚
            6. `halo.admin-path` ä¸ºåå°ç®¡ç†çš„æ ¹è·¯å¾„ï¼Œé»˜è®¤ä¸º `admin`ï¼Œå¦‚æœä½ å®³æ€•åˆ«äººçŒœå‡ºæ¥é»˜è®¤çš„ `admin`ï¼ˆå°±ç®—çŒœå‡ºæ¥ï¼Œå¯¹æ–¹ä»€ä¹ˆéƒ½åšä¸äº†ï¼‰ï¼Œè¯·è‡ªè¡Œè®¾ç½®ã€‚ä»…æ”¯æŒä¸€çº§ï¼Œä¸”å‰åä¸å¸¦ `/`ã€‚
            7. `halo.cache` ä¸ºç³»ç»Ÿç¼“å­˜å½¢å¼çš„é…ç½®ï¼Œå¯é€‰ `memory` å’Œ `level`ï¼Œé»˜è®¤ä¸º `memory`ï¼Œå°†æ•°æ®ç¼“å­˜åˆ°å†…å­˜ï¼Œä½¿ç”¨è¯¥æ–¹å¼çš„è¯ï¼Œé‡å¯åº”ç”¨ä¼šå¯¼è‡´ç¼“å­˜æ¸…ç©ºã€‚å¦‚æœé€‰æ‹©
            `level`ï¼Œåˆ™ä¼šå°†æ•°æ®ç¼“å­˜åˆ°ç£ç›˜ï¼Œé‡å¯ä¸ä¼šæ¸…ç©ºç¼“å­˜ã€‚å¦‚ä¸çŸ¥é“å¦‚ä½•é€‰æ‹©ï¼Œå»ºè®®é»˜è®¤ã€‚

            æ³¨æ„ï¼š

            ä½¿ç”¨ MySQL ä¹‹å‰ï¼Œå¿…é¡»è¦å…ˆæ–°å»ºä¸€ä¸ª `halodb` æ•°æ®åº“ï¼ŒMySQL ç‰ˆæœ¬éœ€ 5.7 ä»¥ä¸Šã€‚

            ```sql
            create database halodb character set utf8mb4 collate utf8mb4_bin;
            ```

            #### è¿è¡ŒHalo

            Halo çš„æ•´ä¸ªåº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ª Jar åŒ…ï¼Œä¸”ä¸åŒ…å«ç”¨æˆ·çš„ä»»ä½•é…ç½®ï¼Œå®ƒæ”¾åœ¨ä»»ä½•ç›®å½•éƒ½æ˜¯å¯è¡Œçš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHalo çš„æ•´ä¸ªé¢å¤–æ–‡ä»¶å…¨éƒ¨å­˜æ”¾åœ¨ `~/.halo` ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬
            `application.yamlï¼ˆç”¨æˆ·é…ç½®æ–‡ä»¶ï¼‰`ï¼Œ`template/themesï¼ˆä¸»é¢˜ç›®å½•ï¼‰`ï¼Œ`uploadï¼ˆé™„ä»¶ä¸Šä¼ ç›®å½•ï¼‰`ï¼Œ`halo.db.mvï¼ˆæ•°æ®åº“æ–‡ä»¶ï¼‰`ã€‚ä¸€å®šè¦ä¿è¯ `~/.halo`
            çš„å­˜åœ¨ï¼Œä½ åšå®¢çš„æ‰€æœ‰èµ„æ–™å¯éƒ½å­˜åœ¨é‡Œé¢ã€‚æ‰€ä»¥ä½ å®Œå…¨ä¸éœ€è¦æ‹…å¿ƒå®‰è£…åŒ…çš„å®‰å±ï¼Œå®ƒä»…ä»…æ˜¯ä¸ªæœåŠ¡è€Œå·²ã€‚è¿è¡ŒHaloæ—¶æ³¨æ„éœ€å…ˆé€€å‡ºHaloç”¨æˆ·ï¼Œè¿›å…¥ä¸€ä¸ªæ‹¥æœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·ä¸‹ã€‚

            ```
            # æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·
            whoami

            # é€€å‡º halo ç™»å½•ï¼Œè¿›å…¥ä¸€ä¸ªæœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·
            su xxx æˆ–è€…ç›´æ¥ exit
            ```

            è¿è¡ŒHalo

            ```
            # ä¸‹è½½æœ€æ–°çš„ Halo å®‰è£…åŒ…ï¼Œ{{version}} ä¸ºç‰ˆæœ¬å·ï¼Œä¸å¸¦ vï¼Œæ›´å¤šä¸‹è½½åœ°å€è¯·è®¿é—® https://halo.run/archives/download.html
            wget https://dl.halo.run/release/halo-{{version}}.jar -O halo-latest.jar

            # å¯åŠ¨æµ‹è¯•
            java -jar halo-latest.jar
            ```

            (2020.8.9 Haloçš„æœ€æ–°ç‰ˆæœ¬ä¸º1.3.2)

            çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¾“å‡ºï¼Œåˆ™è¯´æ˜å¯åŠ¨æˆåŠŸã€‚

            ```
            run.halo.app.listener.StartedListener : Halo started at http://127.0.0.1:8090
            run.halo.app.listener.StartedListener : Halo admin started at http://127.0.0.1:8090/admin
            run.halo.app.listener.StartedListener : Halo has started successfully!
            ```

            ä¸è¿‡ä»¥ä¸Šçš„å¯åŠ¨ä»…ä»…ä¸ºæµ‹è¯• Halo æ˜¯å¦å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¦‚æœæˆ‘ä»¬å…³é—­ ssh è¿æ¥ï¼ŒHalo ä¹Ÿå°†è¢«å…³é—­ã€‚

            #### è¿›é˜¶é…ç½®

            æ–°å¢ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥å®ç°ä¸€äº›å¦‚å¼€æœºè‡ªå¯çš„åŠŸèƒ½ã€‚

            ```
            # ä¸‹è½½ Halo å®˜æ–¹çš„ halo.service æ¨¡æ¿
            sudo curl -o /etc/systemd/system/halo.service --create-dirs https://dl.halo.run/config/halo.service
            ```

            ä¿®æ”¹æ–‡ä»¶

            ```
            # ä¿®æ”¹ halo.service
            sudo vim /etc/systemd/system/halo.service
            ```

            æ‰“å¼€å¦‚ä¸‹

            ```
            [Unit]
            Description=Halo Service
            Documentation=https://halo.run
            After=network-online.target
            Wants=network-online.target

            [Service]
            User=halo
            Type=simple
            ExecStart=/usr/bin/java -server -Xms256m -Xmx256m -jar YOUR_JAR_PATH
            ExecStop=/bin/kill -s QUIT $MAINPID
            Restart=always
            StandOutput=syslog

            StandError=inherit

            [Install]
            WantedBy=multi-user.target
            ```

            å‚æ•°ï¼š

            - `-Xms256m`ï¼šä¸º JVM å¯åŠ¨æ—¶åˆ†é…çš„å†…å­˜ï¼Œè¯·æŒ‰ç…§æœåŠ¡å™¨çš„å†…å­˜åšé€‚å½“è°ƒæ•´ï¼Œ512 M å†…å­˜çš„æœåŠ¡å™¨æ¨èè®¾ç½®ä¸º 128ï¼Œ1G å†…å­˜çš„æœåŠ¡å™¨æ¨èè®¾ç½®ä¸º 256ï¼Œé»˜è®¤ä¸º 256ã€‚
            - `-Xmx256m`ï¼šä¸º JVM è¿è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„æœ€å¤§å†…å­˜ï¼Œé…ç½®åŒä¸Šã€‚
            - `YOUR_JAR_PATH`ï¼šHalo å®‰è£…åŒ…çš„ç»å¯¹è·¯å¾„,ä½¿ç”¨`pwd`å‘½ä»¤æŸ¥çœ‹ï¼Œå¦‚`/www/wwwroot/halo-latest.jar`ã€‚

            æç¤ºï¼š

            - systemd ä¸­çš„æ‰€æœ‰è·¯å¾„å‡è¦å†™ä¸ºç»å¯¹è·¯å¾„ï¼Œå¦å¤–ï¼Œ`~` åœ¨ systemd ä¸­ä¹Ÿæ˜¯æ— æ³•è¢«è¯†åˆ«çš„ï¼Œæ‰€ä»¥è¯·ä¸è¦å†™æˆç±»ä¼¼ `~/halo-latest.jar` è¿™ç§è·¯å¾„ã€‚
            - å¦‚ä½•æ£€éªŒæ˜¯å¦ä¿®æ”¹æ­£ç¡®ï¼šé‡æ–°è¿è¡ŒHaloï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é¢„æœŸè¾“å‡ºã€‚

            ```
            # ä¿®æ”¹ service æ–‡ä»¶ä¹‹åéœ€è¦åˆ·æ–° Systemd
            sudo systemctl daemon-reload

            # ä½¿ Halo å¼€æœºè‡ªå¯
            sudo systemctl enable halo

            # å¯åŠ¨ Halo
            sudo service halo start

            # é‡å¯ Halo
            sudo service halo restart

            # åœæ­¢ Halo
            sudo service halo stop

            # æŸ¥çœ‹ Halo çš„è¿è¡ŒçŠ¶æ€
            sudo service halo status
            ```

            å®Œæˆä»¥ä¸Šæ“ä½œä»¥åå³å¯é€šè¿‡åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥`ä½ çš„æœåŠ¡å™¨IPåœ°å€:ç«¯å£å·ï¼ˆé»˜è®¤ä¸º8090ï¼‰`è®¿é—®äº†ã€‚é€šè¿‡åç»­æ“ä½œå®ç°ä»åŸŸåè®¿é—®Haloã€‚
            ***
            ### é…ç½®åŸŸåè®¿é—®



            - ä½¿ç”¨ Nginx è¿›è¡Œåå‘ä»£ç†
            - æˆ–è€…ä½¿ç”¨ Caddy è¿›è¡Œåå‘ä»£ç†

            ä»¥ä¸Šä¸¤ç§æ–¹æ³•ä»»é€‰å…¶ä¸€å³å¯ã€‚
            ***
            ### ä½¿ç”¨ Nginx è¿›è¡Œåå‘ä»£ç†



            #### å®‰è£…Nginx

            ```
            # æ·»åŠ  Nginx æº
            sudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm

            # å®‰è£… Nginx
            sudo yum install -y nginx

            # å¯åŠ¨ Nginx
            sudo systemctl start nginx.service

            # è®¾ç½®å¼€æœºè‡ªå¯ Nginx
            sudo systemctl enable nginx.service
            ```

            #### é…ç½®Nginx

            ```
            # ä¸‹è½½ Halo å®˜æ–¹çš„ Nginx é…ç½®æ¨¡æ¿
            curl -o /etc/nginx/conf.d/halo.conf --create-dirs https://dl.halo.run/config/nginx.conf
            ```

            ä¸‹è½½å®Œæˆåï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹

            ```
            # ä½¿ç”¨ vim ç¼–è¾‘ halo.conf
            vim /etc/nginx/conf.d/halo.conf
            ```

            æ‰“å¼€å¦‚ä¸‹

            ```
            server {
            listen 80;

            server_name example.com www.example.com;

            location / {
            proxy_set_header HOST $host;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

            proxy_pass http://127.0.0.1:8090/;
            }
            }
            ```

            > è¯·æŠŠ`example.com`æ”¹ä¸ºè‡ªå·±çš„åŸŸå

            ä¿®æ”¹å®Œæˆå

            ```
            # æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰è¯¯
            sudo nginx -t

            # é‡è½½ Nginx é…ç½®
            sudo nginx -s reload
            ```

            #### é…ç½®SSLè¯ä¹¦

            ä»¥ä¸‹æ˜¯è‡ªåŠ¨ç”³è¯·è¯ä¹¦çš„æ–¹æ³•ï¼Œå¦‚æœä½ è‡ªå¤‡äº†è¯ä¹¦ï¼Œè¯·æŸ¥é˜…ç›¸å…³æ•™ç¨‹ã€‚

            ```
            # å®‰è£… certbot ä»¥åŠ certbot nginx æ’ä»¶
            sudo yum install certbot python2-certbot-nginx -y

            # æ‰§è¡Œé…ç½®ï¼Œä¸­é€”ä¼šè¯¢é—®ä½ çš„é‚®ç®±ï¼Œå¦‚å®å¡«å†™å³å¯
            sudo certbot --nginx

            # è‡ªåŠ¨ç»­çº¦
            sudo certbot renew --dry-run
            ```

            åˆ°è¿™é‡Œï¼Œå…³äº Nginx çš„é…ç½®ä¹Ÿå°±å®Œæˆäº†ï¼Œç°åœ¨ä½ å¯ä»¥è®¿é—®ä¸€ä¸‹è‡ªå·±çš„åŸŸåï¼Œå¹¶è¿›è¡Œ Halo çš„åˆå§‹åŒ–äº†ã€‚

            åœ¨è®¾ç½®äº†åå‘ä»£ç†ä¹‹åï¼Œè¯·ä¸€å®šè®°å¾—å» Halo çš„ç®¡ç†ç«¯è®¾ç½®ä¸€ä¸‹æ­£ç¡®çš„åšå®¢åœ°å€ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆèµ„æºè·å–ä¸æˆåŠŸã€‚
            ***
            ### æˆ–è€…ä½¿ç”¨ Caddy è¿›è¡Œåå‘ä»£ç†



            `Caddy` æ˜¯ä¸€æ¬¾ä½¿ç”¨ `Go` è¯­è¨€å¼€å‘çš„ `Web` æœåŠ¡å™¨ã€‚å…¶é…ç½®æ›´ä¸ºç®€æ´ï¼Œå¹¶å¯ä»¥è‡ªåŠ¨ç”³è¯·åŠé…ç½® SSL è¯ä¹¦ï¼ˆæ¨èï¼‰ã€‚

            #### å®‰è£…Caddy

            ```
            # å®‰è£… Caddy è½¯ä»¶åŒ…
            yum install caddy -y
            ```

            #### é…ç½®Caddy

            ```
            # ä¸‹è½½ Halo å®˜æ–¹çš„ Caddy é…ç½®æ¨¡æ¿
            curl -o /etc/caddy/conf.d/Caddyfile.conf --create-dirs https://dl.halo.run/config/Caddyfile
            ```

            ä¸‹è½½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚

            ```
            # ä½¿ç”¨ vim ç¼–è¾‘ Caddyfile
            vim /etc/caddy/conf.d/Caddyfile.conf
            ```

            æ‰“å¼€ä»¥å

            ```
            https://www.simple.com {
            gzip
            tls xxxx@xxx.xx
            proxy / localhost:port {
            transparent
            }
            }
            ```

            1. æŠŠ `https://www.simple.com` æ”¹ä¸ºè‡ªå·±çš„åŸŸåã€‚
            2. `tls` åé¢çš„ `xxxx@xxx.xx` æ”¹ä¸ºè‡ªå·±çš„é‚®ç®±åœ°å€ï¼Œè¿™æ˜¯ç”¨äºè‡ªåŠ¨ç”³è¯· SSL è¯ä¹¦ç”¨çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸éœ€è¦ä½ è‡ªå·±é…ç½® SSL è¯ä¹¦ï¼Œè€Œä¸”ä¼šè‡ªåŠ¨å¸®ä½ ç»­ç­¾ã€‚
            3. `localhost:port` è¯·å°† `port` ä¿®æ”¹ä¸º Halo çš„è¿è¡Œç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º 8090ã€‚

            ä¿®æ”¹å®Œæˆåå¯åŠ¨CaddyæœåŠ¡å³å¯ã€‚

            ```
            # å¼€å¯è‡ªå¯ Caddy æœåŠ¡
            systemctl enable caddy

            # å¯åŠ¨ Caddy
            service caddy start

            # åœæ­¢è¿è¡Œ Caddy
            service caddy stop

            # é‡å¯ Caddy
            service caddy restart

            # æŸ¥çœ‹ Caddy è¿è¡ŒçŠ¶æ€
            service caddy status
            ```

            å¦‚æœ Caddy å¯åŠ¨å‡ºç°è¯¸å¦‚ `[/usr/lib/systemd/system/caddy.service:23] Unknown lvalue 'AmbientCapabilities' in section
            'Service'` è¿™æ ·çš„é—®é¢˜ï¼Œè¯·ä½¿ç”¨ `yum update -y` æ›´æ–°ç³»ç»Ÿã€‚ç„¶åå†ä½¿ç”¨ `service caddy restart` é‡å¯ï¼Œå·²çŸ¥ `CentOS 7.3` ä¼šå‡ºç°è¯¥é—®é¢˜ã€‚

            #### è¿›é˜¶è®¾ç½®

            å¤šç½‘å€é‡å®šå‘åˆ°ä¸»ç½‘å€ï¼Œæ¯”å¦‚è®¿é—® `simple.com` è·³è½¬åˆ° `www.simple.com` åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

            ```
            # ä½¿ç”¨ vim ç¼–è¾‘ Caddyfile
            vim /etc/caddy/conf.d/Caddyfile.conf
            ```

            æ‰“å¼€ä¹‹åæˆ‘ä»¬åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šæ·»åŠ ä»¥ä¸‹é…ç½®

            ```
            https://simple.com {
            redir https://www.simple.com{url}
            }
            ```

            å°† `https://simple.com` å’Œ `https://www.simple.com{url}` ä¿®æ”¹ä¸ºè‡ªå·±éœ€è¦çš„ç½‘å€å°±è¡Œäº†ï¼Œæ¯”å¦‚æˆ‘è¦æ±‚è®¿é—® `example.com `è·³è½¬åˆ°
            `www.example.com`ï¼Œå®Œæ•´çš„é…ç½®å¦‚ä¸‹ï¼š

            ```
            https://example.com {
            redir https://www.example.com {url}
            }

            https://www.example.com {
            gzip
            tls i@example.com
            proxy / localhost:8090 {
            transparent
            }
            }
            ```

            æœ€åæˆ‘ä»¬é‡å¯ `Caddy` å³å¯ã€‚

            `service caddy restart`

            åˆ°è¿™é‡Œï¼Œå…³äº `Caddy` åå‘ä»£ç†çš„é…ç½®ä¹Ÿå°±å®Œæˆäº†ï¼Œç°åœ¨ä½ å¯ä»¥è®¿é—®ä¸€ä¸‹è‡ªå·±çš„åŸŸåï¼Œå¹¶è¿›è¡Œ `Halo` çš„åˆå§‹åŒ–äº†ã€‚

            åœ¨è®¾ç½®äº†åå‘ä»£ç†ä¹‹åï¼Œè¯·ä¸€å®šè®°å¾—å» Halo çš„ç®¡ç†ç«¯è®¾ç½®ä¸€ä¸‹æ­£ç¡®çš„åšå®¢åœ°å€ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆèµ„æºè·å–ä¸æˆåŠŸã€‚
            ***
            ### æ›´æ–°Halo



            ```
            # å¤‡ä»½æ•°æ®
            cp -r ~/.halo ~/.halo.bak

            # å¤‡ä»½æ—§çš„å®‰è£…åŒ…
            mv halo-latest.jar halo-latest.jar.bak

            # ä¸‹è½½æœ€æ–°çš„ Halo å®‰è£…åŒ…ï¼Œ{{version}} ä¸ºç‰ˆæœ¬å·ï¼Œä¸å¸¦ vï¼Œæ›´å¤šä¸‹è½½åœ°å€è¯·è®¿é—® https://halo.run/archives/download.html
            wget https://dl.halo.run/release/halo-{{version}}.jar -O halo-latest.jar

            # æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨
            java -jar halo-latest.jar

            # é‡å¯åº”ç”¨
            service halo restart
            ```
            ***

        </article>
        <!-- ç½®é¡¶æŒ‰é’® -->
        <aside class="home"></aside>
    </section>

    <!-- è¯„è®ºæ¨¡å— -->
    <section class="comment w">
        <form action="" class="submit_wrapper">
            <div class="info">
                <input type="text" required="required" placeholder="æ˜µç§°/ID *å¿…å¡«">
                <input type="text" required="required" placeholder="é‚®ç®± *å¿…å¡«">
            </div>
            <div class=" comm">
                <textarea name="" id="" placeholder="çœ‹åˆ°è¿™é‡Œäº†ï¼Œç•™ä¸‹ä¸€å¥è¯„è®ºå§ï¼" required="required"></textarea>
            </div>
            <input type="submit" value="æäº¤" class="submit">
        </form>
        <div class="comments">
            <div class="a_comment">
                <h4 class="com_id">Name</h4>
                <i class="com_date">2020.9.27</i>
                <p class="com_content">
                    è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚
                    è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚
                    è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚
                    è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚
                    è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚
                    è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚
                    è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚è¿™æ˜¯ä¸€æ¡è¯„è®ºã€‚
                </p>
            </div>
        </div>
    </section>

    <!-- åº•éƒ¨æ¨¡å— -->
    <footer class="w">
        <div class="footer_info">
            <p class="copyright">
                2020&nbsp;&copy;&nbsp;<a href="#">Megrax</a>
            </p>
            <p class="beian">
                <a href="https://beian.miit.gov.cn/">æµ™ICPå¤‡20017337å·</a>
            </p>
        </div>
    </footer>
</body>

</html>